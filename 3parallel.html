---
title: 3. Parallel
layout: page
---

<input id="photos" type="file" multiple="" />
<div id="results"></div>

<p><i>Thanks to Loreto Parisi for assistance with this implementation.</i></p>

<script type="module">
  import { Client } from "https://cdn.jsdelivr.net/npm/@gradio/client/dist/index.min.js";

  async function getPrediction(client, file) {
    const result = await client.predict("/predict", {
      img: file, // send blob directly instead of base64 string
    });
    const label = result.data[0].label;
    const url = URL.createObjectURL(file);
    const div = document.createElement("div");
    div.innerHTML = `<br/><img src="${url}" width="300"> <p>${label}</p>`;
    document.body.append(div);
  }

  photos.addEventListener("input", async () => {
    results.innerHTML = "";
    const files = Array.from(photos.files);
    const client = await Client.connect("andreas-yin/test-model");
    await Promise.allSettled(
      // The spread operator turns the FileList into an array
      // That way, we can use Array.map()
      [...photos.files].map((file) => getPrediction(client, file)),
    );
  });
</script>
